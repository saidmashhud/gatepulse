# HookLine v2.1 Release Notes

## W3C Trace Context Propagation

HookLine now supports end-to-end distributed tracing via [W3C Trace Context](https://www.w3.org/TR/trace-context/) headers.

### How it works

1. **Ingest:** When publishing events via `POST /v1/events`, include `traceparent` and optionally `tracestate` HTTP headers.
2. **Store:** HookLine stores the trace context in a `_trace` metadata field on the event.
3. **Deliver:** When delivering the webhook to an endpoint, HookLine includes the original `traceparent` and `tracestate` headers in the HTTP request.

### Example

```bash
# Publish with trace context
curl -X POST http://localhost:8080/v1/events \
  -H "Authorization: Bearer dev-secret" \
  -H "Content-Type: application/json" \
  -H "traceparent: 00-4bf92f3577b34da6a3ce929d0e0e4736-00f067aa0ba902b7-01" \
  -H "tracestate: congo=t61rcWkgMzE" \
  -d '{"topic":"orders.created","payload":{"order_id":"123"}}'

# The webhook delivery to your endpoint will include:
#   traceparent: 00-4bf92f3577b34da6a3ce929d0e0e4736-00f067aa0ba902b7-01
#   tracestate: congo=t61rcWkgMzE
```

Events published without trace headers are delivered without them — no trace context is fabricated.

### Integration with Control-Plane Services

When a control-plane service forwards requests to HookLine, it can include `traceparent`/`tracestate` extracted from upstream metadata. This enables full end-to-end tracing: client → control-plane → HookLine → consumer endpoint.

## New Test Suite

- **`test/trace-propagation.sh`** — verifies W3C trace headers flow from event publish through delivery to the consumer endpoint

```bash
HL_URL=http://localhost:8080 \
HL_API_KEY=dev-secret \
./test/trace-propagation.sh
```

## Full Changelog

- W3C Trace Context propagation (`traceparent`, `tracestate`) stored and forwarded on delivery
- `_trace` metadata field on events
- New test suite: `test/trace-propagation.sh`
